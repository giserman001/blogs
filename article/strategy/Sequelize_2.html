<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sequelize - model definition | 清风拂林</title>
    <meta name="description" content="Vuepress blog">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/blogs/assets/css/0.styles.1ee95762.css" as="style"><link rel="preload" href="/blogs/assets/js/app.7af11709.js" as="script"><link rel="preload" href="/blogs/assets/js/2.c3ec3d61.js" as="script"><link rel="preload" href="/blogs/assets/js/19.83eb060b.js" as="script"><link rel="preload" href="/blogs/assets/js/8.67da3a0f.js" as="script"><link rel="prefetch" href="/blogs/assets/js/10.1b4e8d03.js"><link rel="prefetch" href="/blogs/assets/js/11.cd9beb7b.js"><link rel="prefetch" href="/blogs/assets/js/12.47dd3072.js"><link rel="prefetch" href="/blogs/assets/js/13.3741830d.js"><link rel="prefetch" href="/blogs/assets/js/14.db69addb.js"><link rel="prefetch" href="/blogs/assets/js/15.25e2fcf7.js"><link rel="prefetch" href="/blogs/assets/js/16.fadf8026.js"><link rel="prefetch" href="/blogs/assets/js/17.ba8dcb23.js"><link rel="prefetch" href="/blogs/assets/js/18.006848d9.js"><link rel="prefetch" href="/blogs/assets/js/20.fe1bb1b8.js"><link rel="prefetch" href="/blogs/assets/js/21.e54f198a.js"><link rel="prefetch" href="/blogs/assets/js/22.9c55068e.js"><link rel="prefetch" href="/blogs/assets/js/23.3f68b056.js"><link rel="prefetch" href="/blogs/assets/js/24.e198140b.js"><link rel="prefetch" href="/blogs/assets/js/25.ba2149f9.js"><link rel="prefetch" href="/blogs/assets/js/26.937efc6d.js"><link rel="prefetch" href="/blogs/assets/js/27.b345483d.js"><link rel="prefetch" href="/blogs/assets/js/28.e069562d.js"><link rel="prefetch" href="/blogs/assets/js/29.7780db6f.js"><link rel="prefetch" href="/blogs/assets/js/3.8d00f85f.js"><link rel="prefetch" href="/blogs/assets/js/30.96acff54.js"><link rel="prefetch" href="/blogs/assets/js/31.56770c86.js"><link rel="prefetch" href="/blogs/assets/js/32.8f6b515f.js"><link rel="prefetch" href="/blogs/assets/js/33.dfe1bf20.js"><link rel="prefetch" href="/blogs/assets/js/34.9b7f0a0d.js"><link rel="prefetch" href="/blogs/assets/js/35.283455cd.js"><link rel="prefetch" href="/blogs/assets/js/36.b6df91e6.js"><link rel="prefetch" href="/blogs/assets/js/37.a1b3bc6d.js"><link rel="prefetch" href="/blogs/assets/js/4.7f6baa92.js"><link rel="prefetch" href="/blogs/assets/js/5.228ee2e5.js"><link rel="prefetch" href="/blogs/assets/js/6.4e178805.js"><link rel="prefetch" href="/blogs/assets/js/7.ae269e8b.js"><link rel="prefetch" href="/blogs/assets/js/9.8cc0e8a3.js">
    <link rel="stylesheet" href="/blogs/assets/css/0.styles.1ee95762.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/" class="home-link router-link-active"><img src="./logo.jpg" alt="清风拂林" class="logo"> <span class="site-name can-hide">清风拂林</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/home.html" class="nav-link">
  web开发记录
</a></div><div class="nav-item"><a href="/blogs/javascript/" class="nav-link">
  javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blogs/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blogs/miniprogram/" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/article/strategy/" class="nav-link router-link-active">
  攻略
</a></li></ul></div></div> <a href="https://github.com/giserman001/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/home.html" class="nav-link">
  web开发记录
</a></div><div class="nav-item"><a href="/blogs/javascript/" class="nav-link">
  javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blogs/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blogs/miniprogram/" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/article/strategy/" class="nav-link router-link-active">
  攻略
</a></li></ul></div></div> <a href="https://github.com/giserman001/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>攻略</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/article/strategy/" class="sidebar-link">Sequelize - quick start(快速开始)</a></li><li><a href="/blogs/article/strategy/Sequelize_2.html" class="active sidebar-link">Sequelize - model definition</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs/article/strategy/Sequelize_3.html" class="sidebar-link">Sequelize - 使用 model 查询数据</a></li><li><a href="/blogs/article/strategy/Sequelize_4.html" class="sidebar-link">Sequelize - 单表 CURD</a></li><li><a href="/blogs/article/strategy/Sequelize_5.html" class="sidebar-link">Sequelize - 多表 CURD</a></li><li><a href="/blogs/article/strategy/Sequelize_6.html" class="sidebar-link">Sequelize - associations</a></li><li><a href="/blogs/article/strategy/T_builds_blog.html" class="sidebar-link">Vuepress搭建静态博客全攻略</a></li><li><a href="/blogs/article/strategy/T_egg_use.html" class="sidebar-link">EggJS基本使用</a></li><li><a href="/blogs/article/strategy/T_mysql.html" class="sidebar-link">mysql基本知识总结</a></li><li><a href="/blogs/article/strategy/T_vue-plugin.html" class="sidebar-link">vue插件总结——总有一款你能用上</a></li><li><a href="/blogs/article/strategy/git_verion_back.html" class="sidebar-link">git回退版本（线上和本地仓库）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#model-definition-模型定义">Model definition - 模型定义</a></li><li><a href="#attributes">Attributes</a></li><li><a href="#attributes-datatypes">Attributes - DataTypes</a></li><li><a href="#attributes-getters-setters">Attributes - getters/setters</a></li><li><a href="#attributes-validations">Attributes - Validations</a></li><li><a href="#configuration">configuration</a></li><li><a href="#数据库同步">数据库同步</a></li><li><a href="#sequelize-import">sequelize.import</a></li><li><a href="#扩展模型">扩展模型</a></li><li><a href="#索引">索引</a></li><li><a href="#相关">相关</a></li></ul></div><p></p> <h3 id="model-definition-模型定义"><a href="#model-definition-模型定义" class="header-anchor">#</a> Model definition - 模型定义</h3> <p><code>Sequelize</code> 使用 <code>define</code> 方法定义模型和表之间的映射，<code>Sequelize</code> 将默认添加 <code>createdAt</code> 和 <code>updatedAt</code> 属性。因此，您将能够知道数据库条目何时进入数据库以及最后一次更新时。
<code>model</code> 定义格式为 <code>sequelize.define('name', {attributes}, {configuration})：</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> User <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
User<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上式代码在数据库中的执行命令为：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span>createdAt<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>updatedAt<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
 <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div> <h4 id="base-demo"><a href="#base-demo" class="header-anchor">#</a> base demo</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Bar <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Foo <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    field<span class="token operator">:</span> <span class="token string">'fooId'</span><span class="token punctuation">,</span> <span class="token comment">// 存入数据库中的字段，model 中还是使用 id =&gt; foo.id</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否自增</span>
    primaryKey<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 是否为主键</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  age<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    defaultValue<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token comment">// 默认值</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否为空</span>
    unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否唯一</span>
    onUpdate<span class="token operator">:</span> <span class="token string">'NO ACTION'</span><span class="token punctuation">,</span> <span class="token comment">// 当被引用的键更新时的操作 String - 可选值是：['CASCADE', 'RESTRICT', 'SET DEFAULT', 'SET NULL', 'NO ACTION']</span>
    onDelete<span class="token operator">:</span> <span class="token string">'NO ACTION'</span><span class="token punctuation">,</span> <span class="token comment">// 当被引用的键删除时的操作 String - 同上</span>
    <span class="token comment">// 验证器</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      isNumeric<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 只允许数字</span>
      max<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      min<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token comment">// 自定义验证</span>
      <span class="token function">isEven</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only even values are allowed!'</span><span class="token punctuation">)</span>
          <span class="token comment">// 我们也在模型的上下文中，所以如果它存在的话,</span>
          <span class="token comment">// this.otherField会得到otherField的值。</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// getters 为列自定义一个访问器 使用this.getDataValue(String)时调用的值</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataValue</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
      <span class="token comment">// 可以对该列进行操作...</span>
      <span class="token keyword">return</span> age
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// setters 为列自定义一个设置器 使用this.setDataValue(String, Value)时调用的值</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newValue <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token number">3</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDataValue</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  uId<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    references<span class="token operator">:</span> <span class="token punctuation">{</span>
      model<span class="token operator">:</span> Bar<span class="token punctuation">,</span> <span class="token comment">// 这是引用另一个模型</span>
      key<span class="token operator">:</span> <span class="token string">'id'</span> <span class="token comment">// 引用的字段（注意是在数据中存在的字段名）比如引用 foos 表要引用 fooId 而不是 id</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Bar<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Foo<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> Foo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">21</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 触发 setters</span>
      <span class="token keyword">const</span> foos <span class="token operator">=</span> <span class="token keyword">await</span> Foo<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 触发 getters</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>上式代码在数据库中的执行命令为：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>bars<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">auto_increment</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span>createdAt<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>updatedAt<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>foos<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>foos<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>fooId<span class="token punctuation">`</span> <span class="token keyword">INTEGER</span> <span class="token keyword">auto_increment</span> <span class="token punctuation">,</span>
  <span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">INTEGER</span> <span class="token keyword">DEFAULT</span> <span class="token number">18</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>uId<span class="token punctuation">`</span> <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>createdAt<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>updatedAt<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>fooId<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>uId<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token punctuation">`</span>bars<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>foos<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>fooId<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>age<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>createdAt<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>updatedAt<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token string">'2019-01-03 07:34:12'</span><span class="token punctuation">,</span><span class="token string">'2019-01-03 07:34:12'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>fooId<span class="token punctuation">`</span> <span class="token keyword">AS</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>age<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>uId<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>createdAt<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>updatedAt<span class="token punctuation">`</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>foos<span class="token punctuation">`</span> <span class="token keyword">AS</span> <span class="token punctuation">`</span>foo<span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="attributes"><a href="#attributes" class="header-anchor">#</a> Attributes</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> User <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  column<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> xxx<span class="token punctuation">,</span>             <span class="token comment">// DataType或字符串，表示列的数据类型 【见下文】</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>       <span class="token comment">// 是否设置 NOT NULL（非空）约束</span>
    defaultValue<span class="token operator">:</span> xxx      <span class="token comment">// 默认值</span>
    unique<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>         <span class="token comment">// 设置为true时，会为列添加唯一约束</span>
    primaryKey<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>     <span class="token comment">// 指定是否是主键</span>
    field<span class="token operator">:</span> xxx<span class="token punctuation">,</span>            <span class="token comment">// String - 设置在数据库中的字段名。设置后会，Sequelize会将属性名映射到数据库中的不同名称</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 是否自增</span>
    references<span class="token operator">:</span> <span class="token punctuation">{</span>          <span class="token comment">// 引用对象</span>
      model<span class="token operator">:</span> xxx<span class="token punctuation">,</span>          <span class="token comment">// 如果列引用到另一个表，可以通过这个属性设置模型或字符串。</span>
      key<span class="token operator">:</span> <span class="token string">'id'</span>            <span class="token comment">// 该列表示到表外键列的引用</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    onUpdate<span class="token operator">:</span> <span class="token string">'NO ACTION'</span><span class="token punctuation">,</span> <span class="token comment">// 当被引用的键更新时的操作 String - 可选值是：['CASCADE', 'RESTRICT', 'SET DEFAULT', 'SET NULL', 'NO ACTION']</span>
    onDelete<span class="token operator">:</span> <span class="token string">'NO ACTION'</span><span class="token punctuation">,</span> <span class="token comment">// 当被引用的键删除时的操作，可选值同上</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>               <span class="token comment">// 为列自定义一个访问器 使用this.getDataValue(String)时调用的值 【见下文】</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token comment">// 为列自定义一个设置器 使用this.setDataValue(String, Value)时调用的值 【见下文】</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>           <span class="token comment">// 模型每次保存时调用的验证对象。可是validator.js中的验证函数(参见 DAOValidator)、或自定义的验证函数 【见下文】</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="attributes-datatypes"><a href="#attributes-datatypes" class="header-anchor">#</a> Attributes - DataTypes</h3> <p>以下是 Sequelize 支持的一些数据类型。 有关完整和更新的列表, 参阅 <a href="http://docs.sequelizejs.com/variable/index.html#static-variable-DataTypes" target="_blank" rel="noopener noreferrer">DataTypes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>                      <span class="token comment">// VARCHAR(255)</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>                <span class="token comment">// VARCHAR(1234)</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">.</span><span class="token constant">BINARY</span>               <span class="token comment">// VARCHAR BINARY</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">TEXT</span>                        <span class="token comment">// TEXT</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">(</span><span class="token string">'tiny'</span><span class="token punctuation">)</span>                <span class="token comment">// TINYTEXT</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span>                     <span class="token comment">// INTEGER</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">BIGINT</span>                      <span class="token comment">// BIGINT</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">BIGINT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>                  <span class="token comment">// BIGINT(11)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">FLOAT</span>                       <span class="token comment">// FLOAT</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>                   <span class="token comment">// FLOAT(11)</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>               <span class="token comment">// FLOAT(11,12)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">REAL</span>                        <span class="token comment">// REAL         仅限于PostgreSQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">REAL</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>                    <span class="token comment">// REAL(11)     仅限于PostgreSQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">REAL</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>                <span class="token comment">// REAL(11,12)  仅限于PostgreSQL.</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">DOUBLE</span>                      <span class="token comment">// DOUBLE</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">DOUBLE</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>                  <span class="token comment">// DOUBLE(11)</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">DOUBLE</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>              <span class="token comment">// DOUBLE(11,12)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">DECIMAL</span>                     <span class="token comment">// DECIMAL</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>              <span class="token comment">// DECIMAL(10,2)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>                        <span class="token comment">// DATETIME 针对 mysql / sqlite, TIMESTAMP WITH TIME ZONE 针对 postgres</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>                     <span class="token comment">// DATETIME(6) 针对 mysql 5.6.4+. 小数秒支持多达6位精度</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">DATEONLY</span>                    <span class="token comment">// DATE 不带时间.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">BOOLEAN</span>                     <span class="token comment">// TINYINT(1)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">ENUM</span><span class="token punctuation">(</span><span class="token string">'value 1'</span><span class="token punctuation">,</span> <span class="token string">'value 2'</span><span class="token punctuation">)</span>  <span class="token comment">// 一个允许具有 “value 1” 和 “value 2” 的 ENUM</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">ARRAY</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">TEXT</span><span class="token punctuation">)</span>       <span class="token comment">// 定义一个数组。 仅限于 PostgreSQL。</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">ARRAY</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">ENUM</span><span class="token punctuation">)</span>       <span class="token comment">// 定义一个 ENUM 数组. 仅限于 PostgreSQL。</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">JSON</span>                        <span class="token comment">// JSON 列. 仅限于 PostgreSQL, SQLite and MySQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">JSONB</span>                       <span class="token comment">// JSONB 列. 仅限于 PostgreSQL .</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">BLOB</span>                        <span class="token comment">// BLOB (PostgreSQL 二进制)</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">BLOB</span><span class="token punctuation">(</span><span class="token string">'tiny'</span><span class="token punctuation">)</span>                <span class="token comment">// TINYBLOB (PostgreSQL 二进制. 其他参数是 medium 和 long)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">UUID</span>                        <span class="token comment">// PostgreSQL 和 SQLite 的 UUID 数据类型, CHAR(36) BINARY 针对于 MySQL (使用默认值: Sequelize.UUIDV1 或 Sequelize.UUIDV4 来让 sequelize 自动生成 ID)</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">CIDR</span>                        <span class="token comment">// PostgreSQL 的 CIDR 数据类型</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">INET</span>                        <span class="token comment">// PostgreSQL 的 INET 数据类型</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">MACADDR</span>                     <span class="token comment">// PostgreSQL 的 MACADDR</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">RANGE</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span>    <span class="token comment">// 定义 int4range 范围. 仅限于 PostgreSQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">RANGE</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">BIGINT</span><span class="token punctuation">)</span>     <span class="token comment">// 定义 int8range 范围. 仅限于 PostgreSQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">RANGE</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span>       <span class="token comment">// 定义 tstzrange 范围. 仅限于 PostgreSQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">RANGE</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">)</span>   <span class="token comment">// 定义 daterange 范围. 仅限于 PostgreSQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">RANGE</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">DECIMAL</span><span class="token punctuation">)</span>    <span class="token comment">// 定义 numrange 范围. 仅限于 PostgreSQL.</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">ARRAY</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">RANGE</span><span class="token punctuation">(</span>Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 定义 tstzrange 范围的数组. 仅限于 PostgreSQL.</span>

Sequelize<span class="token punctuation">.</span><span class="token constant">GEOMETRY</span>                    <span class="token comment">// 空间列.  仅限于 PostgreSQL (具有 PostGIS) 或 MySQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">GEOMETRY</span><span class="token punctuation">(</span><span class="token string">'POINT'</span><span class="token punctuation">)</span>           <span class="token comment">// 具有几何类型的空间列.  仅限于 PostgreSQL (具有 PostGIS) 或 MySQL.</span>
Sequelize<span class="token punctuation">.</span><span class="token constant">GEOMETRY</span><span class="token punctuation">(</span><span class="token string">'POINT'</span><span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span>     <span class="token comment">// 具有几何类型和SRID的空间列.  仅限于 PostgreSQL (具有 PostGIS) 或 MySQL.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="attributes-getters-setters"><a href="#attributes-getters-setters" class="header-anchor">#</a> Attributes - getters/setters</h3> <p>可以在模型上定义'对象属性' <code>getter</code> 和 <code>setter</code> 函数，这些可以用于映射到数据库字段的“保护”属性，也可以用于定义“伪”属性。</p> <p><code>Getters</code> 和 <code>Setters</code> 可以通过两种方式定义（您可以混合使用这两种方式）：</p> <ul><li>作为属性定义的一部分</li> <li>作为模型参数的一部分</li></ul> <blockquote><p>注意: 如果在两个地方定义了 <code>getter</code> 或 <code>setter</code>，那么在相关属性定义中找到的函数始终是优先的。</p></blockquote> <h4 id="定义为属性定义的一部分"><a href="#定义为属性定义的一部分" class="header-anchor">#</a> 定义为属性定义的一部分</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Employee <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'employee'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataValue</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
      <span class="token comment">// 'this' 允许你访问实例的属性</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataValue</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' ('</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">')'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDataValue</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> val<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Employee<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Employee<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'senior engineer'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">employee</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>employee<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// John Doe (SENIOR ENGINEER)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>employee<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// SENIOR ENGINEER</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="定义为模型参数的一部分"><a href="#定义为模型参数的一部分" class="header-anchor">#</a> 定义为模型参数的一部分</h4> <p>以下是在模型参数中定义 <code>getter</code> 和 <code>setter</code> 的示例。
<code>fullName getter</code>，是一个说明如何在模型上定义伪属性的例子 - 这些属性实际上不是数据库模式的一部分。 事实上，伪属性可以通过两种方式定义：使用模型 <code>getter</code>，或者使用虚拟数据类型的列。 虚拟数据类型可以有验证，而虚拟属性的 <code>getter</code> 则不能。</p> <p>请注意，<code>fullName getter</code> 函数中引用的 <code>this.firstname</code> 和 <code>this.lastname</code> 将触发对相应 <code>getter</code> 函数的调用。 如果你不想那样使用<code>getDataValue()</code>方法来访问原始值（见下文）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Foo <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
  <span class="token string">'foo'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    firstname<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    lastname<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    getterMethods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstname <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    setterMethods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">fullName</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> names <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDataValue</span><span class="token punctuation">(</span><span class="token string">'firstname'</span><span class="token punctuation">,</span> names<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDataValue</span><span class="token punctuation">(</span><span class="token string">'lastname'</span><span class="token punctuation">,</span> names<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

Foo<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> Foo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstname<span class="token operator">:</span> <span class="token string">'guo'</span><span class="token punctuation">,</span> lastname<span class="token operator">:</span> <span class="token string">'dada'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> Foos <span class="token operator">=</span> <span class="token keyword">await</span> Foo<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Foos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'fullName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// guo dada</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="attributes-validations"><a href="#attributes-validations" class="header-anchor">#</a> Attributes - Validations</h3> <p>模型验证，允许您为模型的每个属性指定格式/内容/继承验证。</p> <p>验证会自动运行在 <code>create</code> ， <code>update</code> 和 <code>save</code> 上。 你也可以调用 <code>validate()</code> 手动验证一个实例。</p> <p>验证由 <a href="https://github.com/chriso/validator.js" target="_blank" rel="noopener noreferrer">validator.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ValidateMe <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      is<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;^[a-z]+$&quot;</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 只允许字母</span>
      is<span class="token operator">:</span> <span class="token regex">/^[a-z]+$/i</span><span class="token punctuation">,</span>          <span class="token comment">// 与上一个示例相同,使用了真正的正则表达式</span>
      not<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;[a-z]&quot;</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token comment">// 不允许字母</span>
      isEmail<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token comment">// 检查邮件格式 (foo@bar.com)</span>
      isUrl<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>              <span class="token comment">// 检查连接格式 (http://foo.com)</span>
      isIP<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>               <span class="token comment">// 检查 IPv4 (129.89.23.1) 或 IPv6 格式</span>
      isIPv4<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>             <span class="token comment">// 检查 IPv4 (129.89.23.1) 格式</span>
      isIPv6<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>             <span class="token comment">// 检查 IPv6 格式</span>
      isAlpha<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token comment">// 只允许字母</span>
      isAlphanumeric<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>     <span class="token comment">// 只允许使用字母数字</span>
      isNumeric<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          <span class="token comment">// 只允许数字</span>
      isInt<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>              <span class="token comment">// 检查是否为有效整数</span>
      isFloat<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token comment">// 检查是否为有效浮点数</span>
      isDecimal<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          <span class="token comment">// 检查是否为任意数字</span>
      isLowercase<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// 检查是否为小写</span>
      isUppercase<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// 检查是否为大写</span>
      notNull<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token comment">// 不允许为空</span>
      isNull<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>             <span class="token comment">// 只允许为空</span>
      notEmpty<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>           <span class="token comment">// 不允许空字符串</span>
      equals<span class="token operator">:</span> <span class="token string">'specific value'</span><span class="token punctuation">,</span> <span class="token comment">// 只允许一个特定值</span>
      contains<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span>          <span class="token comment">// 检查是否包含特定的子字符串</span>
      notIn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 检查是否值不是其中之一</span>
      isIn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 检查是否值是其中之一</span>
      notContains<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span>       <span class="token comment">// 不允许包含特定的子字符串</span>
      len<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token comment">// 只允许长度在2到10之间的值</span>
      isUUID<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token comment">// 只允许uuids</span>
      isDate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>             <span class="token comment">// 只允许日期字符串</span>
      isAfter<span class="token operator">:</span> <span class="token string">&quot;2011-11-05&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// 只允许在特定日期之后的日期字符串</span>
      isBefore<span class="token operator">:</span> <span class="token string">&quot;2011-11-05&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// 只允许在特定日期之前的日期字符串</span>
      max<span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>                  <span class="token comment">// 只允许值 &lt;= 23</span>
      min<span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>                  <span class="token comment">// 只允许值 &gt;= 23</span>
      isCreditCard<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>       <span class="token comment">// 检查有效的信用卡号码</span>

      <span class="token comment">// 也可以自定义验证:</span>
      <span class="token function">isEven</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only even values are allowed!'</span><span class="token punctuation">)</span>
          <span class="token comment">// 我们也在模型的上下文中，所以如果它存在的话, </span>
          <span class="token comment">// this.otherField会得到otherField的值。</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>请注意，如果需要将多个参数传递给内置的验证函数，则要传递的参数必须位于数组中。 但是，如果要传递单个数组参数，例如isIn的可接受字符串数组，则将被解释为多个字符串参数，而不是一个数组参数。 要解决这个问题，传递一个单一长度的参数数组，比如<code>[['one'，'two']]</code>。</p> <p>要使用自定义错误消息而不是 <code>validator.js</code> 提供的错误消息，请使用对象而不是纯值或参数数组，例如不需要参数的验证器可以被给定自定义消息:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>isInt<span class="token operator">:</span> <span class="token punctuation">{</span>
  msg<span class="token operator">:</span> <span class="token string">&quot;Must be an integer number of pennies&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>或者如果还需要传递参数，请添加一个 <code>args</code> 属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>isIn<span class="token operator">:</span> <span class="token punctuation">{</span>
  args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token string">'zh'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  msg<span class="token operator">:</span> <span class="token string">&quot;Must be English or Chinese&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当使用自定义验证器函数时，错误消息将是抛出的 <code>Error</code> 对象所持有的任何消息。</p> <p>有关内置验证方法的更多详细信息，请参阅<a href="https://github.com/chriso/validator.js" target="_blank" rel="noopener noreferrer">the validator.js project<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <h4 id="验证器-与-allownull"><a href="#验证器-与-allownull" class="header-anchor">#</a> 验证器 与 allowNull</h4> <p>如果模型的特定字段设置为允许null（使用 <code>allowNull：true</code> ），并且该值已设置为 <code>null</code> ，则其验证器不会运行。</p> <p>这意味着，您可以有一个字符串字段，该字段验证其长度至少为5个字符，但也允许为 <code>null</code>。</p> <p>你可以通过设置 <code>notNull</code> 验证器来自定义 <code>allowNull</code> 错误消息, 像这样</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> User <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span>
      notNull<span class="token operator">:</span> <span class="token punctuation">{</span>
        msg<span class="token operator">:</span> <span class="token string">'Please enter your name'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="模型验证"><a href="#模型验证" class="header-anchor">#</a> 模型验证</h4> <p>验证器也可以在特定字段验证器之后用来定义检查模型。例如，你可以确保纬度和经度都不设置，或者两者都设置，如果设置了一个而另一个未设置则验证失败。</p> <p>模型验证器方法与模型对象的上下文一起调用，如果它们抛出错误，则认为失败，否则通过。 这与自定义字段特定的验证器一样。</p> <p>所收集的任何错误消息都将与验证结果对象一起放在字段验证错误中，这个错误使用在 <code>validate</code> 参数对象中以失败的验证方法的键来命名。即便在任何一个时刻，每个模型验证方法只能有一个错误消息，它会在数组中显示为单个字符串错误，以最大化与字段错误的一致性。</p> <p>一个例子:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Pub <span class="token operator">=</span> Sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'pub'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  address<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  latitude<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    defaultValue<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span> min<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  longitude<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    allowNull<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    defaultValue<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    validate<span class="token operator">:</span> <span class="token punctuation">{</span> min<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">180</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  validate<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">bothCoordsOrNone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>latitude <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>longitude <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Require either both latitude and longitude or neither'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>在这种简单情况下，如果给定纬度或经度，而不是同时包含两者，则验证失败。 如果我们尝试构建一个超范围的纬度和经度，那么 <code>raging_bullock_arms.validate()</code> 可能会返回</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">'latitude'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Invalid number: latitude'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">'bothCoordsOrNone'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Require either both latitude and longitude or neither'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> configuration</h3> <p>你还可以修改 <code>Sequelize</code> 处理列名称的方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Bar <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
  <span class="token string">'bar'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">/* bla */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 不添加时间戳属性 (updatedAt, createdAt)</span>
    timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 不删除数据库条目，但将新添加的属性deletedAt设置为当前日期（删除完成时）。</span>
    <span class="token comment">// paranoid 只有在启用时间戳时才能工作</span>
    paranoid<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 将自动设置所有属性的字段选项为下划线命名方式。</span>
    <span class="token comment">// 不会覆盖已经定义的字段选项</span>
    underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 禁用修改表名; 默认情况下，sequelize将自动将所有传递的模型名称（define的第一个参数）转换为复数。 如果你不想这样，请设置以下内容</span>
    freezeTableName<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 定义表的名称</span>
    tableName<span class="token operator">:</span> <span class="token string">'my_very_custom_table_name'</span><span class="token punctuation">,</span>

    <span class="token comment">// 启用乐观锁定。 启用时，sequelize将向模型添加版本计数属性，</span>
    <span class="token comment">// 并在保存过时的实例时引发OptimisticLockingError错误。</span>
    <span class="token comment">// 设置为true或具有要用于启用的属性名称的字符串。</span>
    version<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>如果你希望 <code>sequelize</code> 处理时间戳，但只想要其中一部分，或者希望您的时间戳被称为别的东西，则可以单独覆盖每个列：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Foo <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
  <span class="token string">'foo'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">/* bla */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 不要忘记启用时间戳！</span>
    timestamps<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 我不想要 createdAt</span>
    createdAt<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 我想 updateAt 实际上被称为 updateTimestamp</span>
    updatedAt<span class="token operator">:</span> <span class="token string">'updateTimestamp'</span><span class="token punctuation">,</span>

    <span class="token comment">// 并且希望 deletedAt 被称为 destroyTime（请记住启用paranoid以使其工作）</span>
    deletedAt<span class="token operator">:</span> <span class="token string">'destroyTime'</span><span class="token punctuation">,</span>
    paranoid<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>您也可以更改数据库引擎，例如 变更到到 <code>MyISAM</code>, 默认值是 <code>InnoDB</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Person <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* attributes */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  engine<span class="token operator">:</span> <span class="token string">'MYISAM'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 或全局的</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> user<span class="token punctuation">,</span> pw<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  define<span class="token operator">:</span> <span class="token punctuation">{</span> engine<span class="token operator">:</span> <span class="token string">'MYISAM'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>最后，您可以为 <code>MySQL</code> 和 <code>PG</code> 中的表指定注释</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Person <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* attributes */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  comment<span class="token operator">:</span> <span class="token string">&quot;I'm a table comment!&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="数据库同步"><a href="#数据库同步" class="header-anchor">#</a> 数据库同步</h3> <p>当开始一个新的项目时，你还不会有一个数据库结构，并且使用 <code>Sequelize</code> 你也不需要它。 只需指定您的模型结构，并让库完成其余操作。 目前支持的是创建和删除表：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建表:</span>
Project<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Task<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 强制创建!</span>
Project<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>force<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 这将先丢弃表，然后重新创建它</span>

<span class="token comment">// 删除表:</span>
Project<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Task<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 事件处理:</span>
Project<span class="token punctuation">.</span><span class="token punctuation">[</span>sync<span class="token operator">|</span>drop<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 好吧...一切都很好！</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// oooh，你输入了错误的数据库凭据？</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>因为同步和删除所有的表可能要写很多行，你也可以让 <code>Sequelize</code> 来为做这些：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 同步所有尚未在数据库中的模型</span>
sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 强制同步所有模型</span>
sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>force<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 删除所有表</span>
sequelize<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 广播处理:</span>
sequelize<span class="token punctuation">.</span><span class="token punctuation">[</span>sync<span class="token operator">|</span>drop<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// woot woot</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// whooops</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>因为 <code>.sync({ force: true })</code> 是具有破坏性的操作，可以使用 <code>match</code> 参数作为附加的安全检查。</p> <p><code>match</code> 参数可以通知 <code>Sequelize</code>，以便在同步之前匹配正则表达式与数据库名称 - 在测试中使用 <code>force：true</code> 但不使用实时代码的情况下的安全检查。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 只有当数据库名称以'_test'结尾时，才会运行.sync（）</span>
sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> match<span class="token operator">:</span> <span class="token regex">/_test$/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="sequelize-import"><a href="#sequelize-import" class="header-anchor">#</a> sequelize.import</h3> <p>您还可以使用 <code>import</code> 方法将模型定义存储在单个文件中。 返回的对象与导入文件的功能中定义的完全相同。</p> <p>例如 <code>models/author.js</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    username<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>app.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> AuthorModel <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'./models/author.js'</span><span class="token punctuation">)</span>

AuthorModel<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> author <span class="token operator">=</span> AuthorModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>author<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="同时导入多个-model"><a href="#同时导入多个-model" class="header-anchor">#</a> 同时导入多个 model</h4> <p>再建立多一个 model <code>models/article.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    <span class="token keyword">from</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      references<span class="token operator">:</span> <span class="token punctuation">{</span>
        model<span class="token operator">:</span> <span class="token string">'authors'</span><span class="token punctuation">,</span>
        key<span class="token operator">:</span> <span class="token string">'id'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>app.js</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">MODELS_PATH</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'models'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token constant">MODELS_PATH</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">MODELS_PATH</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> author<span class="token operator">:</span> AuthorModel<span class="token punctuation">,</span> article <span class="token punctuation">}</span> <span class="token operator">=</span> sequelize<span class="token punctuation">.</span>models
  AuthorModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token operator">:</span> <span class="token string">'guodada'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">author</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>author<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token comment">// guodada</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="扩展模型"><a href="#扩展模型" class="header-anchor">#</a> 扩展模型</h3> <p><code>Sequelize</code> 模型是ES6类。 您可以轻松添加自定义实例或类级别的方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> User <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> firstname<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 添加一个类级别的方法</span>
User<span class="token punctuation">.</span><span class="token function-variable function">classLevelMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'foo'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加实例级别方法</span>
<span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">instanceLevelMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'bar'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>当然，您还可以访问实例的数据并生成虚拟的 getter:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> User <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> firstname<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span> lastname<span class="token operator">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getFullname</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>firstname<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 例子:</span>
User<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstname<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> lastname<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'foo bar'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h3> <p><code>Sequelize</code> 支持在 <code>Model.sync()</code> 或 <code>sequelize.sync</code> 中创建的模型定义中添加索引。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
  <span class="token string">'user'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    indexes<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 在 email 上创建一个唯一索引</span>
      <span class="token punctuation">{</span>
        unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 在使用 jsonb_path_ops 的 operator 数据上创建一个 gin 索引</span>
      <span class="token punctuation">{</span>
        fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        using<span class="token operator">:</span> <span class="token string">'gin'</span><span class="token punctuation">,</span>
        operator<span class="token operator">:</span> <span class="token string">'jsonb_path_ops'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 默认的索引名将是 [table]_[fields]</span>
      <span class="token comment">// 创建多列局部索引</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'public_by_author'</span><span class="token punctuation">,</span>
        fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'author'</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        where<span class="token operator">:</span> <span class="token punctuation">{</span>
          status<span class="token operator">:</span> <span class="token string">'public'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 具有有序字段的BTREE索引</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'title_index'</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">'BTREE'</span><span class="token punctuation">,</span>
        fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'author'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> attribute<span class="token operator">:</span> <span class="token string">'title'</span><span class="token punctuation">,</span> collate<span class="token operator">:</span> <span class="token string">'en_US'</span><span class="token punctuation">,</span> order<span class="token operator">:</span> <span class="token string">'DESC'</span><span class="token punctuation">,</span> length<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="相关"><a href="#相关" class="header-anchor">#</a> 相关</h3> <ul><li><a href="http://docs.sequelizejs.com/manual/tutorial/models-definition.html" target="_blank" rel="noopener noreferrer">models-definition<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/demopark/sequelize-docs-Zh-CN/blob/master/models-definition.md" target="_blank" rel="noopener noreferrer">models-definition 中文版<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/giserman001/blogs/edit/master/docs/article/strategy/Sequelize_2.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blogs/article/strategy/" class="prev router-link-active">
        Sequelize - quick start(快速开始)
      </a></span> <span class="next"><a href="/blogs/article/strategy/Sequelize_3.html">
        Sequelize - 使用 model 查询数据
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blogs/assets/js/app.7af11709.js" defer></script><script src="/blogs/assets/js/2.c3ec3d61.js" defer></script><script src="/blogs/assets/js/19.83eb060b.js" defer></script><script src="/blogs/assets/js/8.67da3a0f.js" defer></script>
  </body>
</html>
