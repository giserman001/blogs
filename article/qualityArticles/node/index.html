<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EggJS基本使用 | 清风拂林</title>
    <meta name="description" content="Vuepress blog">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/blogs/assets/css/0.styles.c474059c.css" as="style"><link rel="preload" href="/blogs/assets/js/app.248911e9.js" as="script"><link rel="preload" href="/blogs/assets/js/2.95a233f8.js" as="script"><link rel="preload" href="/blogs/assets/js/3.827a8b77.js" as="script"><link rel="preload" href="/blogs/assets/js/8.a4c6aa02.js" as="script"><link rel="prefetch" href="/blogs/assets/js/10.d25dbe75.js"><link rel="prefetch" href="/blogs/assets/js/11.5b81390d.js"><link rel="prefetch" href="/blogs/assets/js/12.4183a76e.js"><link rel="prefetch" href="/blogs/assets/js/13.8314297e.js"><link rel="prefetch" href="/blogs/assets/js/14.5cf8f634.js"><link rel="prefetch" href="/blogs/assets/js/15.b2acc318.js"><link rel="prefetch" href="/blogs/assets/js/16.cbb9a9f5.js"><link rel="prefetch" href="/blogs/assets/js/17.466677ce.js"><link rel="prefetch" href="/blogs/assets/js/18.95f61eb1.js"><link rel="prefetch" href="/blogs/assets/js/19.123d2b70.js"><link rel="prefetch" href="/blogs/assets/js/20.3f77e04b.js"><link rel="prefetch" href="/blogs/assets/js/21.15fce626.js"><link rel="prefetch" href="/blogs/assets/js/22.b264c40b.js"><link rel="prefetch" href="/blogs/assets/js/23.a1663ce7.js"><link rel="prefetch" href="/blogs/assets/js/24.5b3166a8.js"><link rel="prefetch" href="/blogs/assets/js/25.22f45898.js"><link rel="prefetch" href="/blogs/assets/js/26.88eb23b1.js"><link rel="prefetch" href="/blogs/assets/js/27.2ec589ea.js"><link rel="prefetch" href="/blogs/assets/js/28.b874dff2.js"><link rel="prefetch" href="/blogs/assets/js/29.a96303ef.js"><link rel="prefetch" href="/blogs/assets/js/30.3be685aa.js"><link rel="prefetch" href="/blogs/assets/js/31.c6cb7d07.js"><link rel="prefetch" href="/blogs/assets/js/32.07132a8d.js"><link rel="prefetch" href="/blogs/assets/js/33.35bd906d.js"><link rel="prefetch" href="/blogs/assets/js/34.b7bdc39f.js"><link rel="prefetch" href="/blogs/assets/js/35.d1df3b26.js"><link rel="prefetch" href="/blogs/assets/js/36.37e8958f.js"><link rel="prefetch" href="/blogs/assets/js/37.d1a44709.js"><link rel="prefetch" href="/blogs/assets/js/38.928044d2.js"><link rel="prefetch" href="/blogs/assets/js/4.5a903a8a.js"><link rel="prefetch" href="/blogs/assets/js/5.27680423.js"><link rel="prefetch" href="/blogs/assets/js/6.9162145b.js"><link rel="prefetch" href="/blogs/assets/js/7.f5be92db.js"><link rel="prefetch" href="/blogs/assets/js/9.2b099204.js">
    <link rel="stylesheet" href="/blogs/assets/css/0.styles.c474059c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="globalLayout"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs/" class="home-link router-link-active"><img src="./logo.jpg" alt="清风拂林" class="logo"> <span class="site-name can-hide">清风拂林</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs/home.html" class="nav-link">
  web开发记录
</a></div><div class="nav-item"><a href="/blogs/javascript/" class="nav-link">
  javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blogs/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blogs/miniprogram/" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/article/strategy/" class="nav-link">
  攻略
</a></li></ul></div></div> <a href="https://github.com/giserman001/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs/home.html" class="nav-link">
  web开发记录
</a></div><div class="nav-item"><a href="/blogs/javascript/" class="nav-link">
  javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blogs/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/blogs/miniprogram/" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="知识库" class="dropdown-title"><span class="title">知识库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs/article/strategy/" class="nav-link">
  攻略
</a></li></ul></div></div> <a href="https://github.com/giserman001/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blogs/home.html" class="sidebar-link">web开发记录</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="eggjs基本使用"><a href="#eggjs基本使用" class="header-anchor">#</a> EggJS基本使用</h1> <div class="custom-block tip"><p class="custom-block-title">记录</p> <p>记录一下自己学习过程，方便以后自己查阅</p></div> <p></p><div class="table-of-contents"><ul><li><a href="#egg-js官网">Egg.js官网</a></li><li><a href="#egg-js-是什么">Egg.js  是什么?</a></li><li><a href="#egg-js-的特性：">Egg.js  的特性：</a></li><li><a href="#egg-js-在阿里的地位">Egg.js  在阿里的地位</a></li><li><a href="#egg-js发展历程">Egg.js发展历程</a></li><li><a href="#egg-js-目录结构介绍">Egg.js  目录结构介绍</a></li><li><a href="#egg-js目录约定规范">Egg.js目录约定规范</a></li><li><a href="#vscode-egg-开发工具配置">Vscode+Egg  开发工具配置</a></li><li><a href="#egg-路由配置">Egg 路由配置</a></li><li><a href="#取获取-get-传值以及动态路由的值">取获取 Get  传值以及动态路由的值</a></li><li><a href="#egg-view-ejs-的使用">egg-view-ejs  的使用</a></li><li><a href="#服务-service-和控制器-controller-相互调用规则">服务(service)和控制器(controller)相互调用规则</a></li><li><a href="#egg-制-安全机制-csrf-的防范">Egg 制 安全机制 CSRF  的防范</a></li><li><a href="#egg-post-提交数据">Egg Post  提交数据</a></li><li><a href="#获取数据-egg-js-获取数据不需要配置中间件直接通过下面方式获取">获取数据(egg.js 获取数据不需要配置中间件直接通过下面方式获取)</a></li><li><a href="#获取-csrf">获取 csrf</a></li><li><a href="#egg-配置模板全局变量">Egg  配置模板全局变量</a></li><li><a href="#eggjs-cookie-简介">Eggjs ----- Cookie  简介</a></li><li><a href="#egg-js-中cookie">Egg.js 中Cookie</a></li><li><a href="#egg-js-中cookie参数options">Egg.js 中Cookie参数options</a></li><li><a href="#egg-js-中设置中文-cookie">Egg.js  中设置中文 Cookie</a></li><li><a href="#eggjs-中session">Eggjs ---- 中Session</a></li><li><a href="#session-工作流">Session 工作流</a></li><li><a href="#egg-js-中session-的使用">Egg.js 中session 的使用</a></li><li><a href="#session-在config-default-js">Session 在config.default.js</a></li><li><a href="#cookie-和-和-session">Cookie 和 和 Session</a></li></ul></div><p></p> <h3 id="egg-js官网"><a href="#egg-js官网" class="header-anchor">#</a> Egg.js官网</h3> <p>官网： https://eggjs.org</p> <p>中文网站: https://eggjs.org/zh-cn/</p> <h3 id="egg-js-是什么"><a href="#egg-js-是什么" class="header-anchor">#</a> Egg.js  是什么?</h3> <p>Egg.js 是《阿里旗下产品》基于 Node.js 和 Koa 是一个 Nodejs 的企业级应用开发框架。
可以帮助发团队和开发人员降低开发和维护成本。
Express 和 Koa 是 Node.js 社区广泛使用的框架，简单且扩展性强，非常适合做个人项
目。但框架本身缺少约定，标准的 MVC 模型会有各种千奇百怪的写法。Egg 按照约定进行
开发，奉行『约定优于配置』，团队协作成本低。
Egg.js 基于 Es6、Es7 以及 Typescript、Koa2 使得 Nodejs 具有更规范的开发模式、更低
的学习成本、更优雅的代码、更少的开发成本、更少的维护成本。</p> <h3 id="egg-js-的特性："><a href="#egg-js-的特性：" class="header-anchor">#</a> Egg.js  的特性：</h3> <ol><li>提供基于 Egg 定制上层框架的能力</li> <li>高度可扩展的插件机制</li> <li>内置多进程管理</li> <li>基于 Koa 开发，性能优异</li> <li>框架稳定，测试覆盖率高</li> <li>渐进式开发</li></ol> <h3 id="egg-js-在阿里的地位"><a href="#egg-js-在阿里的地位" class="header-anchor">#</a> Egg.js  在阿里的地位</h3> <p><img src="/blogs/assets/img/egg.8966bd88.png" alt="截图"></p> <h3 id="egg-js发展历程"><a href="#egg-js发展历程" class="header-anchor">#</a> Egg.js发展历程</h3> <ol><li>2013 年蚂蚁的 chair 框架，可以视为 egg 的前身。</li> <li>2015 年 11 月，在苏千的召集下，阿里各 BU 的前端骨干齐聚黄龙，闭门共建。</li> <li>2016 年初，各 BU 的基础 web 框架完成升级，在同一套规范的基础上进行差异化定制。</li> <li>2016 年中，广泛使用在绝大部分阿里的前端 Node.js 应用。</li> <li>2016 年 09 月，在 JSConf China 2016 上亮相并宣布开源。</li> <li>2017 年初，官网文档 egg - 为企业级框架和应用而生 亮相，并将在本月发布 egg@1.0版本。</li> <li>2017 年 12 月左右 Egg 社区版 2.0 正式发布，性能提升 30%，基于 koa2 拥抱 Async</li> <li>2018 年 7 月最新 egg 的版本是 2.2.1</li></ol> <p>经过几年的沉淀 Egg 已经非常成熟。</p> <h3 id="egg-js-目录结构介绍"><a href="#egg-js-目录结构介绍" class="header-anchor">#</a> Egg.js  目录结构介绍</h3> <p><img src="/blogs/assets/img/egg_file.361aa26b.png" alt="截图"></p> <h3 id="egg-js目录约定规范"><a href="#egg-js目录约定规范" class="header-anchor">#</a> Egg.js目录约定规范</h3> <p><img src="/blogs/assets/img/egg_file1.f5035831.png" alt="截图"></p> <p>egg工作流</p> <p><img src="/blogs/assets/img/egg_flow.b4430cf6.jpg" alt="截图"></p> <h3 id="vscode-egg-开发工具配置"><a href="#vscode-egg-开发工具配置" class="header-anchor">#</a> Vscode+Egg  开发工具配置</h3> <p><img src="/blogs/assets/img/egg_file2.1269b4af.png" alt="截图"></p> <h3 id="egg-路由配置"><a href="#egg-路由配置" class="header-anchor">#</a> Egg 路由配置</h3> <p>https://eggjs.org/zh-cn/basics/router.html</p> <h3 id="取获取-get-传值以及动态路由的值"><a href="#取获取-get-传值以及动态路由的值" class="header-anchor">#</a> 取获取 Get  传值以及动态路由的值</h3> <p>https://eggjs.org/zh-cn/basics/controller.html</p> <h3 id="egg-view-ejs-的使用"><a href="#egg-view-ejs-的使用" class="header-anchor">#</a> egg-view-ejs  的使用</h3> <p>https://github.com/eggjs/egg-view-ejs</p> <ol><li>安装</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i egg<span class="token operator">-</span>view<span class="token operator">-</span>ejs <span class="token operator">--</span>save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>找到 {app_root}/config/plugin.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span>ejs <span class="token operator">=</span> <span class="token punctuation">{</span>
  enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'egg-view-ejs'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>找到 {app_root}/config/config.default.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">appInfo</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// use for cookie sign key, should change to your own and keep security</span>
  config<span class="token punctuation">.</span>keys <span class="token operator">=</span> appInfo<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'_1532498393023_7447'</span>
  <span class="token comment">// add your config here</span>
  config<span class="token punctuation">.</span>middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">//配置 ejs 模板引擎</span>
  config<span class="token punctuation">.</span>view <span class="token operator">=</span> <span class="token punctuation">{</span>
    mapping<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'.html'</span><span class="token operator">:</span> <span class="token string">'ejs'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="服务-service-和控制器-controller-相互调用规则"><a href="#服务-service-和控制器-controller-相互调用规则" class="header-anchor">#</a> 服务(service)和控制器(controller)相互调用规则</h3> <p><img src="/blogs/assets/img/egg-flow.81bf2937.png" alt="截图"></p> <h3 id="egg-制-安全机制-csrf-的防范"><a href="#egg-制-安全机制-csrf-的防范" class="header-anchor">#</a> Egg 制 安全机制 CSRF  的防范</h3> <p><a href="https://eggjs.org/zh-cn/core/security.html" target="_blank" rel="noopener noreferrer">https://eggjs.org/zh-cn/core/security.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="egg-post-提交数据"><a href="#egg-post-提交数据" class="header-anchor">#</a> Egg Post  提交数据</h3> <blockquote><p>第一种post提交数据</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;/news/doAdd?_csrf=&lt;%=csrf%&gt; &quot;</span> method<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span><span class="token operator">&gt;</span>
  用户名<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>br<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
  密 码<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>第二种post提交数据</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;/news/doAdd&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;hidden&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;_csrf&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;&lt;%=csrf%&gt;&quot;</span><span class="token operator">&gt;</span>
  用户名<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>br<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
  密 码<span class="token operator">:</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&quot;submit&quot;</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="获取数据-egg-js-获取数据不需要配置中间件直接通过下面方式获取"><a href="#获取数据-egg-js-获取数据不需要配置中间件直接通过下面方式获取" class="header-anchor">#</a> 获取数据(egg.js 获取数据不需要配置中间件直接通过下面方式获取)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="获取-csrf"><a href="#获取-csrf" class="header-anchor">#</a> 获取 csrf</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>csrf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="egg-配置模板全局变量"><a href="#egg-配置模板全局变量" class="header-anchor">#</a> Egg  配置模板全局变量</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>csrf<span class="token operator">=</span>ctx<span class="token punctuation">.</span>csrf<span class="token punctuation">;</span> <span class="token comment">// 设置全局变量</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="eggjs-cookie-简介"><a href="#eggjs-cookie-简介" class="header-anchor">#</a> Eggjs ----- Cookie  简介</h3> <ol><li>cookie 是存储于访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名的时候共享数据。</li> <li>HTTP 是无状态协议。简单地说，当你浏览了一个页面，然后转到同一个网站的另一个页面，服务器无法认识到这是同一个浏览器在访问同一个网站。每一次的访问，都是没有任何关系的。</li></ol> <h3 id="egg-js-中cookie"><a href="#egg-js-中cookie" class="header-anchor">#</a> Egg.js 中Cookie</h3> <div class="custom-block tip"><p class="custom-block-title">语法</p> <p>Cookie  设置语法： ctx.cookies.set(key, value, options)</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">语法</p> <p>Cookie  获取语法：ctx.cookies.get(key, options)</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>::: 语法
Cookie  清除语法：ctx.cookies.set(key, null, options)
或者设置 maxAge 过期时间为 0
:::</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="egg-js-中cookie参数options"><a href="#egg-js-中cookie参数options" class="header-anchor">#</a> Egg.js 中Cookie参数options</h3> <p><a href="https://eggjs.org/zh-cn/core/cookie-and-session.html" target="_blank" rel="noopener noreferrer">https://eggjs.org/zh-cn/core/cookie-and-session.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="custom-block tip"><p class="custom-block-title">建议</p> <p>设置 cookie  建议的写法如下</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maxAge<span class="token operator">:</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// by default it's true</span>
  encrypt<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// cookies are encrypted during network transmission</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'frontend-cookie'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  encrypt<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="egg-js-中设置中文-cookie"><a href="#egg-js-中设置中文-cookie" class="header-anchor">#</a> Egg.js  中设置中文 Cookie</h3> <ol><li>第一种解决方案：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 转换成 base64 字符串：aGVsbG8sIHdvcmxkIQ==</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'aGVsbG8sIHdvcmxkIQ=='</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 还原 base64 字符串：hello, world!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>第二种解决方案：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  maxAge<span class="token operator">:</span><span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// by default it's true</span>
  encrypt<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// cookies are encrypted during network transmission</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="eggjs-中session"><a href="#eggjs-中session" class="header-anchor">#</a> Eggjs ---- 中Session</h3> <p>session 是另一种记录客户状态的机制，不同的是 Cookie 保存在客户端浏览器中，而session 保存在服务器上</p> <h3 id="session-工作流"><a href="#session-工作流" class="header-anchor">#</a> Session 工作流</h3> <p>当浏览器访问服务器并发送第一次请求时，服务器端会创建一个 session 对象，生成一个类似于 key,value 的键值对， 然后将 key(cookie)返回到浏览器(客户)端，浏览器下次再访问时，携带 key(cookie)，找到对应的 session(value)。</p> <h3 id="egg-js-中session-的使用"><a href="#egg-js-中session-的使用" class="header-anchor">#</a> Egg.js 中session 的使用</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>egg.js 中 session 基于 egg-session 内置了对 session 的操作</p></div> <ol><li>设置</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>userinfo<span class="token operator">=</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span><span class="token string">'20'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>获取</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> userinfo<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>session
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>Session  的默认设置</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>exports<span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">'EGG_SESS'</span><span class="token punctuation">,</span>
  maxAge<span class="token operator">:</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 1 day</span>
  httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  encrypt<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="session-在config-default-js"><a href="#session-在config-default-js" class="header-anchor">#</a> Session 在config.default.js</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>config<span class="token punctuation">.</span>session<span class="token operator">=</span><span class="token punctuation">{</span>
  key<span class="token operator">:</span><span class="token string">'SESSION_ID'</span><span class="token punctuation">,</span>
  maxAge<span class="token operator">:</span><span class="token number">864000</span><span class="token punctuation">,</span>
  renew<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//延长会话有效期</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="cookie-和-和-session"><a href="#cookie-和-和-session" class="header-anchor">#</a> Cookie 和 和 Session</h3> <ol><li>cookie 数据存放在客户的浏览器上，session 数据放在服务器上。</li> <li>cookie 相比 session 没有 session 安全，别人可以分析存放在本地的 COOKIE 并进行 COOKIE欺骗。</li> <li>session 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能考虑到减轻服务器性能方面，应当使用 COOKIE。</li> <li>单个 cookie 保存的数据不能超过 4K，很多浏览器都限制一个站点最多保存 20 个 cookie。</li></ol> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/giserman001/blogs/edit/master/docs/article/qualityArticles/node/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div> <div id="money" class="animate" data-v-cabd9b56><span data-v-cabd9b56></span> <em class="close" data-v-cabd9b56></em> <div class="shadow" data-v-cabd9b56></div> <ul data-v-cabd9b56><li data-v-cabd9b56><span data-v-cabd9b56>支付宝扫一扫、领红包</span> <img src="/blogs/images/zf-s.jpg" data-v-cabd9b56></li> <li data-v-cabd9b56><span data-v-cabd9b56>支持一杯coffee</span> <img src="/blogs/images/wx.jpg" data-v-cabd9b56></li> <li data-v-cabd9b56><span data-v-cabd9b56>赏下百两黄金：</span> <img src="/blogs/images/zf.jpg" data-v-cabd9b56></li></ul></div></div><div class="global-ui"><!----></div></div>
    <script src="/blogs/assets/js/app.248911e9.js" defer></script><script src="/blogs/assets/js/2.95a233f8.js" defer></script><script src="/blogs/assets/js/3.827a8b77.js" defer></script><script src="/blogs/assets/js/8.a4c6aa02.js" defer></script>
  </body>
</html>
